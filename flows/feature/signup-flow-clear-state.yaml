# Signup Flow with Clear State - Comprehensive User Registration
# Handles onboarding and signup with clean app state

appId: com.scopex.scopexmobile
name: "Signup Flow with Clear State"
tags: ["feature", "signup", "onboarding", "authentication", "clear-state"]

# Environment variables
env:
  TEST_START_TIME: "${Date.now()}"
  PLATFORM: "${maestro.platform}"
  USER_EMAIL: "${USER_EMAIL:-scopexverifieduser@yopmail.com}"
  USER_OTP: "${USER_OTP:-000000}"

# Flow hooks for setup and cleanup
onFlowStart:
  - evalScript: "output.testStartTime = Date.now();"
  - evalScript: "output.stepCount = 0;"

onFlowComplete:
  - evalScript: "const duration = Date.now() - output.testStartTime;"
  - evalScript: "output.stepCount++;"
  - takeScreenshot: "signup-flow-clear-state-complete"

---
# Start screen recording
- startRecording:
    path: 'signup-flow-clear-state'
    label: 'Signup Flow with Clear State Recording'

# Step 1: Launch the app with state clearing
- launchApp:
    appId: "com.scopex.scopexmobile"
    clearState: true
    clearKeychain: true

# Step 2: Wait for app to load
- extendedWaitUntil:
    visible: "Continue"
    timeout: 15000

# Step 3: Navigate through onboarding
# Screen 1: Initial onboarding
- assertVisible: "Send more.*"
- assertVisible: "Continue"

# Navigate to next screen
- tapOn: "Continue"

# Screen 2: Trusted by thousands
- assertVisible: "Trusted by thousands.*"
- assertVisible: "Continue"

# Navigate to next screen
- tapOn: "Continue"

# Screen 3: Designed for love
- assertVisible: "Designed for love.*"
- assertVisible: "Get Started"

# Complete onboarding
- tapOn: "Get Started"

# Step 4: Handle signup flow
# Verify navigation to signup screen
- assertVisible: "Sign.*"
- extendedWaitUntil:
    visible: "Sign up to continue"
    timeout: 10000

# Tap on Sign up
- tapOn: "Sign up to continue"

# Verify email input screen
- extendedWaitUntil:
    visible: "Email"
    timeout: 10000

# Enter email
- tapOn: "Email"
- inputText: "${USER_EMAIL}"

# Tap Next
- tapOn: "Verify"
- tapOn: "Verify"
# Handle OTP flow
- tapOn: "Login with code"

# Enter OTP
- tapOn:
    id: "otp-input-0"
- inputText: "0"
- tapOn:
    id: "otp-input-1"
- inputText: "0"
- tapOn:
    id: "otp-input-2"
- inputText: "0"
- tapOn:
    id: "otp-input-3"
- inputText: "0"
- tapOn:
    id: "otp-input-4"
- inputText: "0"
- tapOn:
    id: "otp-input-5"
- inputText: "0"

# Complete OTP verification
- repeat:
    while:
      visible: "Verify"
    commands:
      - tapOn: "Verify"



# Step 5: Verify successful signup
- extendedWaitUntil:
    visible: "Send Money"
    timeout: 15000

# Step 6: Take final screenshot
- takeScreenshot: "signup-flow-clear-state-complete"

# Step 7: Final verification
- assertTrue: "maestro.appId === 'com.scopex.scopexmobile'"

# Stop recording
- stopRecording
