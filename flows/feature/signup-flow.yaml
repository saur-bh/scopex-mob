# Signup Flow - Comprehensive User Registration
# Handles both onboarding and direct signup scenarios intelligently

appId: com.scopex.scopexmobilev2
name: "Signup Flow Test"
tags: ["feature", "signup", "onboarding", "authentication", "critical"]

# Environment variables
env:
  TEST_START_TIME: "${Date.now()}"
  PLATFORM: "${maestro.platform}"
  USER_EMAIL: "teshank.2137@gmail.com"
  USER_OTP: "000000"

# Flow hooks for setup and cleanup
onFlowStart:
  - evalScript: "console.log('ðŸš€ Starting Signup Flow Test on ' + maestro.platform);"
  - evalScript: "output.testStartTime = Date.now();"
  - evalScript: "output.stepCount = 0;"

onFlowComplete:
  - evalScript: "const duration = Date.now() - output.testStartTime; console.log('âœ… Signup Flow Test completed in ' + duration + 'ms');"
  - evalScript: "console.log('Total steps executed: ' + output.stepCount);"
  - takeScreenshot: "signup-flow-complete"

---
# Start screen recording
- startRecording:
    path: 'signup-flow'
    label: 'Signup Flow Test Recording'

# Step 1: Launch the app with state clearing
- evalScript: "console.log('Step 1: Launching app with state clearing...'); output.stepCount++;"
- launchApp:
    appId: "com.scopex.scopexmobilev2"
    clearState: true
    clearKeychain: true

# Step 2: Wait for app to load
- evalScript: "console.log('Step 2: Waiting for app to load...'); output.stepCount++;"
- extendedWaitUntil:
    visible: "Continue"
    timeout: 15000
- evalScript: "console.log('App loaded successfully');"

# Step 3: Navigate through onboarding (keep clicking Continue until signup)
- evalScript: "console.log('Step 3: Navigating through onboarding screens...'); output.stepCount++;"

# Step 3: Execute onboarding flow (from flow-con.txt)
- evalScript: "console.log('Step 3: Starting onboarding flow from flow-con.txt...'); output.stepCount++;"

# Screen 1: Initial onboarding
- evalScript: "console.log('Step 3.1: Verifying initial onboarding screen...');"
- assertVisible: "Send more.*"
- assertVisible: "Continue"
- evalScript: "console.log('Initial onboarding screen verified');"

# Navigate to next screen
- evalScript: "console.log('Step 3.2: Navigating to second onboarding screen...');"
- tapOn: "Continue"

# Screen 2: Trusted by thousands
- evalScript: "console.log('Step 3.3: Verifying second onboarding screen...');"
- assertVisible: "Trusted by thousands.*"
- assertVisible: "Continue"
- evalScript: "console.log('Second onboarding screen verified');"

# Navigate to next screen
- evalScript: "console.log('Step 3.4: Navigating to third onboarding screen...');"
- tapOn: "Continue"

# Screen 3: Designed for love
- evalScript: "console.log('Step 3.5: Verifying third onboarding screen...');"
- assertVisible: "Designed for love.*"
- assertVisible: "Get Started"
- evalScript: "console.log('Third onboarding screen verified');"

# Complete onboarding
- evalScript: "console.log('Step 3.6: Completing onboarding...');"
- tapOn: "Get Started"
- evalScript: "console.log('Onboarding completed successfully');"

# Step 4: Handle signup flow
- evalScript: "console.log('Step 4: Starting signup flow...'); output.stepCount++;"

# Verify navigation to signup screen
- evalScript: "console.log('Step 4.1: Verifying signup screen...');"
- assertVisible: "Sign Up"
- assertVisible: "Sign up to continue"
- evalScript: "console.log('Signup screen verified');"

# Tap on Sign up
- evalScript: "console.log('Step 4.2: Tapping Sign up...');"
- tapOn: "Sign up to continue"

# Verify email input screen
- evalScript: "console.log('Step 4.3: Verifying email input screen...');"
- extendedWaitUntil:
    visible: "Email"
    timeout: 10000
- evalScript: "console.log('Email input screen verified');"

# Enter email
- evalScript: "console.log('Step 4.4: Entering email...');"
- tapOn: "Email"
- inputText: "teshank.2137@gmail.com"
- evalScript: "console.log('Email entered: teshank.2137@gmail.com');"


# Tap Next
- evalScript: "console.log('Step 4.6: Tapping Next...');"
- tapOn: "Next"
- tapOn: "Next"

# Handle OTP flow
- evalScript: "console.log('Step 4.7: Handling OTP flow...');"
- tapOn: "Login with code"
- evalScript: "console.log('Login with code tapped');"

# Enter OTP
- evalScript: "console.log('Step 4.8: Entering OTP...');"
- tapOn:
    point: "11%,41%"
- inputText: "000000"
- evalScript: "console.log('OTP entered: 000000');"

# Complete OTP verification
- evalScript: "console.log('Step 4.9: Completing OTP verification...');"
- tapOn: "Next"
- tapOn: "Next"
- evalScript: "console.log('OTP verification completed');"

# Step 5: Verify successful signup
- evalScript: "console.log('Step 5: Verifying successful signup...'); output.stepCount++;"
- extendedWaitUntil:
    visible: "Send Money"
    timeout: 15000
- evalScript: "console.log('Signup completed successfully - Send Money screen visible');"

# Step 6: Take final screenshot
- evalScript: "console.log('Step 6: Taking final screenshot...'); output.stepCount++;"
- takeScreenshot: "signup-flow-complete"

# Step 7: Final verification
- evalScript: "console.log('Step 7: Final verification...'); output.stepCount++;"
- assertTrue: "maestro.appId === 'com.scopex.scopexmobilev2'"
- evalScript: "console.log('Signup flow test completed successfully!');"
- evalScript: "console.log('Total steps executed: ' + output.stepCount);"

# Stop recording
- evalScript: "console.log('Recording completed - Signup flow test finished');"
- stopRecording
