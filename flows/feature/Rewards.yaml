# Rewards - This is to test Rewards
# This is to test Rewards

# IMPORTANT: Use Maestro Studio to record your test steps!
# 1. Run: maestro studio
# 2. Record your test actions
# 3. Copy the generated commands to replace the placeholder steps below

appId: com.scopex.scopexmobile
name: "Rewards"
tags: ["smoke", "clear-state"]

# Environment variables
env:
  TEST_START_TIME: "${Date.now()}"
  PLATFORM: "${maestro.platform}"
  MAX_RETRIES: "3"

# Flow hooks for setup and cleanup
onFlowStart:
  - evalScript: "output.testStartTime = Date.now();"
  - evalScript: "output.stepCount = 0;"

onFlowComplete:
  - evalScript: "const duration = Date.now() - output.testStartTime;"
  - evalScript: "output.stepCount++;"
  - takeScreenshot: "Rewards-complete"

---
# Start screen recording
- startRecording:
    path: 'Rewards'
    label: 'Rewards Recording'

# Step 1: Launch the app with state clearing
- launchApp:
    appId: "com.scopex.scopexmobile"
    clearState: true
    clearKeychain: true

# Step 2: Wait for app to load
- extendedWaitUntil:
    visible: "Continue"
    timeout: 15000

# Step 3: Navigate through onboarding
# Screen 1: Initial onboarding
- assertVisible: "Continue"

# Navigate to next screen
- tapOn: "Continue"

# Screen 2: Trusted by thousands
- assertVisible: "Continue"

# Navigate to next screen
- tapOn: "Continue"

# Screen 3: Designed for love
- assertVisible: "Get Started"

# Complete onboarding
- tapOn: "Get Started"

# Step 4: Handle signup flow
# Verify navigation to signup screen
- assertVisible: "Sign.*"
- assertVisible: "Sign up to continue"

# Tap on Sign up
- tapOn: "Sign up to continue"

# Verify email input screen
- extendedWaitUntil:
    visible: "Email"
    timeout: 10000

# Enter email
- tapOn: "Email"
- inputText: "scopexverifieduser@yopmail.com"

- repeat:
    while:
      visible: "Continue"
    commands:
      - tapOn: "Continue"

# Handle OTP flow
- tapOn: "Login with code"

# Enter OTP
- tapOn:
    id: "otp-input-0"
- inputText: "0"
- tapOn:
    id: "otp-input-1"
- inputText: "0"
- tapOn:
    id: "otp-input-2"
- inputText: "0"
- tapOn:
    id: "otp-input-3"
- inputText: "0"
- tapOn:
    id: "otp-input-4"
- inputText: "0"
- tapOn:
    id: "otp-input-5"
- inputText: "0"

# Complete OTP verification
- repeat:
    while:
      visible: "Verify"
    commands:
      - tapOn: "Verify"



# Step 5: Verify successful signup
- extendedWaitUntil:
    visible: "Send Money"
    timeout: 15000

# Step 1: Open hamburger menu
- tapOn:
    id: header-button
    index: 0

# Step 2: Navigate to Rewards
- tapOn: "Rewards"

# Verify Rewards page loaded
- assertVisible: "Share."
- assertVisible: "Earn."
- assertVisible: "Repeat."
- assertVisible: "Get â‚¬50 every time 3 friends sign up and transact. No limits."

# Step 3: Tap on Copy icon (next to referral code)
- tapOn:
    point: "66%,56%"

# # Step 4: Tap on Share icon (commented out as in original)
# - tapOn:
#     point: "82%,48%"
# - assertVisible: "Share via 'Nearby Share'"
# - assertVisible: "WhatsApp"
# - assertVisible: "LinkedIn"
# - assertVisible: "Instagram"

# # Close the share dialog by tapping outside or back
# - tapOn:
#     point: "50%,20%" # Tap on empty area to close share dialog

# Step 5: Scroll down to see more content
- scroll

# Step 6: Verify the content after scrolling
- assertVisible: "Wondering how does this work?"
- assertVisible: "Step 1.*"
- assertVisible: "Step 2.*"
- assertVisible: "Step 3.*"
- scroll
- assertVisible: "Step 4.*"
- assertVisible: "Step 5.*"

# Step 8: Take screenshot
- evalScript: "console.log('Step 8: Taking screenshot...');"
- takeScreenshot: "Rewards-complete"

# Step 9: Final verification
- evalScript: "console.log('Step 9: Final verification...');"
- assertTrue: "maestro.appId === 'com.scopex.scopexmobile'"
- evalScript: "console.log('Rewards test completed successfully!');"

# Stop recording
- evalScript: "console.log('Recording completed - Rewards test finished');"
- stopRecording

# ============================================================================
# INSTRUCTIONS FOR RECORDING TEST STEPS:
# ============================================================================
# 1. Start Maestro Studio:
#    maestro studio
#
# 2. Record your test actions:
#    - Navigate through your app
#    - Perform the actions you want to test
#    - Maestro will generate the commands
#
# 3. Copy the generated commands and replace the placeholder steps above
#    - Look for the TODO comments
#    - Replace with your recorded commands
#
# 4. Test your flow:
#    ./run-tests.sh flows/feature/Rewards.yaml
# ============================================================================
