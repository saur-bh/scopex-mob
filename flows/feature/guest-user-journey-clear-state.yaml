# Guest User Journey with Clear State - Enhanced with Advanced Maestro Features
# Comprehensive regression test for guest user flow with clean app state

appId: com.scopex.scopexmobilev2
name: "Guest User Journey with Clear State"
tags: ["feature", "guest", "onboarding", "clear-state", "critical"]

# Environment variables
env:
  TEST_START_TIME: "${Date.now()}"
  PLATFORM: "${maestro.platform}"
  MAX_RETRIES: "3"

# Flow hooks for setup and cleanup
onFlowStart:
  - evalScript: "output.testStartTime = Date.now();"
  - evalScript: "output.stepCount = 0;"

onFlowComplete:
  - evalScript: "const duration = Date.now() - output.testStartTime;"
  - evalScript: "output.stepCount++;"
  - takeScreenshot: "guest-user-journey-clear-state-complete"

---
# Start screen recording
- startRecording:
    path: 'guest-user-journey-clear-state'
    label: 'Guest User Journey with Clear State Recording'

# Step 1: Launch the app with state clearing
- launchApp:
    appId: "com.scopex.scopexmobilev2"
    clearState: true
    clearKeychain: true

# Step 2: Wait for app to load and verify initial screen
- extendedWaitUntil:
    visible: "Continue"
    timeout: 15000

# Step 3: Execute onboarding flow
# Screen 1: Initial onboarding
- assertVisible: "25 Paisa better than google rates"
- assertVisible: "â‚¬10 Reward on first transaction"
- assertVisible: "Continue"

# Navigate to next screen
- tapOn: "Continue"

# Screen 2: Trusted by thousands
- assertVisible: "Trusted by .*"
- assertVisible: "25 Paisa better than Google rates"
- assertVisible: "Continue"

# Navigate to next screen
- tapOn: "Continue"

# Screen 3: Designed for love
- assertVisible: "Designed.*"
- assertVisible: "Get Started"

# Complete onboarding
- tapOn: "Get Started"

# Step 4: Verify navigation to home screen
- assertVisible: "Save extra when sending home"
- assertVisible: "Sign Up"

# Step 6: Test tab navigation with enhanced selectors
# Home tab navigation
- tapOn: "Home"

# Compare tab navigation
- tapOn: "Compare"
# Settings tab navigation
- tapOn: "Settings"

# Step 7: Verify main navigation elements with scroll support
# Use scrollUntilVisible for elements that might be off-screen

- tapOn: "Transfers"
- assertVisible: "Sign up to.*"

- assertVisible: "Wallet"
- tapOn: "Wallet"

- assertVisible: '(?i).+\bverify\s+to\s+claim\b.+'



# Step 9: Take final screenshot
- takeScreenshot: "guest-user-journey-clear-state-complete"

# Step 10: Verify test completion and log results
- assertTrue: "maestro.appId === 'com.scopex.scopexmobilev2'"

# Stop recording
- stopRecording
