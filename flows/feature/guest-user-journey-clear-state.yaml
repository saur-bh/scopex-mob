# Guest User Journey with Clear State - Enhanced with Advanced Maestro Features
# Comprehensive regression test for guest user flow with clean app state

appId: com.scopex.scopexmobile
name: "Guest User Journey with Clear State"
tags: ["feature", "guest", "onboarding", "clear-state", "smoke"]

# Environment variables
env:
  TEST_START_TIME: "${Date.now()}"
  PLATFORM: "${maestro.platform}"
  MAX_RETRIES: "3"

# Flow hooks for setup and cleanup
onFlowStart:
  - evalScript: "output.testStartTime = Date.now();"
  - evalScript: "output.stepCount = 0;"

onFlowComplete:
  - evalScript: "const duration = Date.now() - output.testStartTime;"
  - evalScript: "output.stepCount++;"
  - takeScreenshot: "guest-user-journey-clear-state-complete"

---
# Start screen recording
- startRecording:
    path: 'guest-user-journey-clear-state'
    label: 'Guest User Journey with Clear State Recording'

# Step 1: Launch the app with state clearing
- launchApp:
    appId: "com.scopex.scopexmobile"
    clearState: true
    clearKeychain: true

# Step 2: Wait for app to load and verify initial screen
- extendedWaitUntil:
    visible: "Continue"
    timeout: 15000

# Step 3: Execute onboarding flow
# Screen 1: Initial onboarding
- assertVisible: "Continue"

# Navigate to next screen
- tapOn: "Continue"

# Screen 2: Trusted by thousands
- assertVisible: "Continue"

# Navigate to next screen
- tapOn: "Continue"

# Screen 3: Designed for love
- assertVisible: "Designed.*"
- assertVisible: "Get Started"

# Complete onboarding
- tapOn: "Get Started"

# Step 4: Verify navigation to home screen
- assertVisible: "Save extra when sending home"
- assertVisible: "Sign Up.*"

# Step 6: Test tab navigation with enhanced selectors
# Wait for main app screen to be visible
- extendedWaitUntil:
    visible: "Save extra when sending home"
    timeout: 10000

# Home tab navigation - use more specific selector
- tapOn:
    text: "Home"
    index: 0
    enabled: true

# Verify we're on home screen
- assertVisible: "Save extra when sending home"

# Compare tab navigation
- tapOn:
    text: "Compare.*"
    index: 0
    enabled: true

# Settings tab navigation
- tapOn:
    text: "Settings"
    index: 0
    enabled: true

# Step 7: Verify main navigation elements with scroll support
# Use scrollUntilVisible for elements that might be off-screen

# Test Transfers section
- tapOn:
    text: "Transfers"
    index: 0
    enabled: true
- assertVisible: "Sign up to.*"

# Test Wallet section
- assertVisible: "Wallet"
- tapOn:
    text: "Wallet"
    index: 0
    enabled: true

# Verify wallet verification message
- assertVisible: '(?i).+\bverify\s+to\s+claim\b.+'



# Step 9: Take final screenshot
- takeScreenshot: "guest-user-journey-clear-state-complete"

# Step 10: Verify test completion and log results
- assertTrue: "maestro.appId === 'com.scopex.scopexmobile'"

# Stop recording
- stopRecording
